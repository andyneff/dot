<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dot Functions &mdash; Dot Core 0.0.3 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Dot Variables" href="dot_env.auto.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Dot Core
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="dot_env.auto.html">Dot Variables</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Dot Functions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Dot Core</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Dot Functions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/dot_functions.auto.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="dot-functions">
<h1>Dot Functions<a class="headerlink" href="#dot-functions" title="Permalink to this heading"></a></h1>
<dl class="bash file">
<dt class="sig sig-object bash" id="file-dot_functions.bsh">
<span class="sig-name descname"><span class="pre">dot_functions.bsh</span></span><a class="headerlink" href="#file-dot_functions.bsh" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>A set of support functions to help make writing dot custom scripts easier, with out introducing additional dependencies.</p>
<p>Most of these function are to assist in writing custom script without having to add extra work for you or learn a lot of bash.</p>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-dot_functions.bsh symlink">
<span class="sig-name descname"><span class="pre">symlink</span></span><a class="headerlink" href="#function-dot_functions.bsh symlink" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Cross OS function for creating a symlink</p>
<p>On windows, either admin privileges are needed, or (less preferred) windows has to be put in a “Developer mode” (by an admin, of course)</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Source filename</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$2</span></code> - Filename of the symlink to be created</p></li>
</ul>
</dd>
</dl>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-dot_functions.bsh backup_and_replace">
<span class="sig-name descname"><span class="pre">backup_and_replace</span></span><a class="headerlink" href="#function-dot_functions.bsh backup_and_replace" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p><strong>Internal function:</strong> The main function that replaces existing files in your home directory with a symlink in your dot files repo.</p>
<p>If a file already exists and is not already a symlink, then it is copied to <span class="target" id="index-0"></span><a class="reference internal" href="dot_env.auto.html#envvar-DOT_BACKUP_DIR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">DOT_BACKUP_DIR</span></code></a>, mimicking the same directory structure as in your home directory.</p>
<p>If the file has already been backed up once, and needs to be backed up again, then an extra <cite>.#</cite> extension is added (counting up from 0) is added. This could be because an external influences replaced the symlink with a file, or on Windows when symlinks could not be used.</p>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-dot_functions.bsh load_dot_env">
<span class="sig-name descname"><span class="pre">load_dot_env</span></span><a class="headerlink" href="#function-dot_functions.bsh load_dot_env" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p><strong>Internal function:</strong> Load and exports the <cite>dot.env</cite> files</p>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-dot_functions.bsh add_if">
<span class="sig-name descname"><span class="pre">add_if</span></span><a class="headerlink" href="#function-dot_functions.bsh add_if" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>When trying to write a custom script to modify configuration files, you will run into situations where you will want to add a block of code if a string doesn’t already exist in the file. There are several corner cases to cover here, does the files exist, does it already end in a newline, etc… This function will add a string if the condition is not met, guaranteeing it is not combine with the last line of the file and make sure the files ends in a newline if the file is modified.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Filename of the file to be modified</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$2</span></code> - Regex condition that must not match any line in the file for the line to be added. Set to empty string to always add the line. Must not contain newlines.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$3</span></code> - Target string to add. May contain newlines.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>add_if<span class="w"> </span>~/.bashrc<span class="w"> </span><span class="s1">&#39;\.personal\.bashrc&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="s1">&#39;if [ -r ~/.personal.bashrc ]; then</span>
<span class="s1">  . ~/.personal.bashrc</span>
<span class="s1">fi&#39;</span>
</pre></div>
</div>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-dot_functions.bsh add_after_if">
<span class="sig-name descname"><span class="pre">add_after_if</span></span><a class="headerlink" href="#function-dot_functions.bsh add_after_if" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>When trying to write a custom script to modify configuration files, you will run into situations where you need to add a configuration line, after another line (such as a header). There are several corner cases to cover here, what if the “prior line” doesn’t already exist and needs to be added? What if the target line has already been added, it shouldn’t be added twice. This function handles all of that for you, so that you can just focusing on making sure you added the target line after the prior line</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Filename of the file to be modified</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$2</span></code> - Prior line to add <code class="docutils literal notranslate"><span class="pre">$3</span></code> after. Must not contain newlines.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$3</span></code> - Target string to add. Must not contain newlines.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<p>In this example, we want to:</p>
<ul class="simple">
<li><p>Always add <code class="docutils literal notranslate"><span class="pre">path</span> <span class="pre">=</span> <span class="pre">~/.default.gitconfig</span></code> after <code class="docutils literal notranslate"><span class="pre">[include]</span></code></p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">path</span> <span class="pre">=</span> <span class="pre">~/.2.11.4.gitconfig</span></code> after <code class="docutils literal notranslate"><span class="pre">[include]</span></code>, but only if git is version 2.11.4 or newer</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">path</span> <span class="pre">=</span> <span class="pre">~/.windows.gitconfig</span></code> after <code class="docutils literal notranslate"><span class="pre">[include]</span></code>, but only if running on Windows</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># git/config</span>
add_after_if<span class="w"> </span>~/.gitconfig<span class="w"> </span><span class="s2">&quot;[include]&quot;</span><span class="w"> </span><span class="s2">&quot;  path = ~/.default.gitconfig&quot;</span>

<span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DOT_CORE_DIR</span><span class="si">}</span><span class="s2">/external/vsi_common/linux/requirements.bsh&quot;</span>
<span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DOT_CORE_DIR</span><span class="si">}</span><span class="s2">/external/vsi_common/linux/versions.bsh&quot;</span>
<span class="k">if</span><span class="w"> </span>meet_requirements<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>git_version<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="s1">&#39;&gt;=2.11.4&#39;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span>add_after_if<span class="w"> </span>~/.gitconfig<span class="w"> </span><span class="s2">&quot;[include]&quot;</span><span class="w"> </span><span class="s2">&quot;  path = ~/.2.11.4.gitconfig&quot;</span>
<span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OS</span><span class="p">-</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Windows_NT&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span>add_after_if<span class="w"> </span>~/.gitconfig<span class="w"> </span><span class="s2">&quot;[include]&quot;</span><span class="w"> </span><span class="s2">&quot;  path = ~/.windows.gitconfig&quot;</span>
<span class="k">fi</span>
</pre></div>
</div>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-dot_functions.bsh validate_ssh_key">
<span class="sig-name descname"><span class="pre">validate_ssh_key</span></span><a class="headerlink" href="#function-dot_functions.bsh validate_ssh_key" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Check to see if an SSH key had a passphrase on it. If it does not, delete the file so that it cannot be used.</p>
<p>SSH keys should not be passphraseless, that’s what ssh agent is for. This function is used to enforce that.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Path of ssh key</p></li>
</ul>
</dd>
</dl>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-dot_functions.bsh gpg_key_batch">
<span class="sig-name descname"><span class="pre">gpg_key_batch</span></span><a class="headerlink" href="#function-dot_functions.bsh gpg_key_batch" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Some good (I hope?) defaults for generating GPG keys. If you want to override this, just define your own <a class="reference internal" href="#function-dot_functions.bsh gpg_key_batch"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">gpg_key_batch</span></code></a>. See <a class="reference external" href="https://www.gnupg.org/documentation/manuals/gnupg/Unattended-GPG-key-generation.html">https://www.gnupg.org/documentation/manuals/gnupg/Unattended-GPG-key-generation.html</a> for more information</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Real Name/Comment</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$2</span></code> - Email address</p></li>
</ul>
</dd>
</dl>
<dl class="bash function">
<dt class="sig sig-object bash" id="function-dot_functions.bsh gen_gpg_key">
<span class="sig-name descname"><span class="pre">gen_gpg_key</span></span><a class="headerlink" href="#function-dot_functions.bsh gen_gpg_key" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Generate a gpg key based on <a class="reference internal" href="#function-dot_functions.bsh gpg_key_batch"><code class="xref bash bash-func docutils literal notranslate"><span class="pre">gpg_key_batch</span></code></a>. While the passphase is initially unset, it will have you change it.</p>
<p>(GPG 2.1 or newer) It will check to see if an GPG key had a passphrase on it. If it does not, the key is <strong>automatically</strong> deleted. GPG keys should not be passphraseless, that’s what gpg agent is for.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$1</span></code> - Real name (also used for comment)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$2</span></code> - Email address</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only tested against GPG 2.0 or 2.1, that was hard enough</p>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="dot_env.auto.html" class="btn btn-neutral float-left" title="Dot Variables" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Andy Neff.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>